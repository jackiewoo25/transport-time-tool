<!DOCTYPE html>
<html lang="zh-Hant">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>運輸流程時間視覺模組</title>
  <style>
    body {
      font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, "Helvetica Neue", Arial;
      background: #f2f4f8;
      margin: 0;
      padding: 20px;
    }
    h2 {
      text-align: center;
      margin-bottom: 20px;
    }
    .section {
      margin-bottom: 30px;
    }
    .section-title {
      font-size: 18px;
      font-weight: bold;
      margin-bottom: 10px;
    }
    .button-group {
      display: flex;
      flex-wrap: wrap;
      gap: 10px;
    }
    .btn {
      padding: 10px 15px;
      border-radius: 16px;
      font-size: 16px;
      border: none;
      backdrop-filter: blur(12px);
      -webkit-backdrop-filter: blur(12px);
      box-shadow: 0 4px 12px rgba(0,0,0,0.1);
      cursor: pointer;
      transition: transform 0.2s;
    }
    .btn:hover {
      transform: scale(1.05);
    }
    .btn.pickup { background: rgba(173, 255, 168, 0.6); }
    .btn.dropoff { background: rgba(173, 216, 230, 0.6); }
    .btn.route { background: rgba(255, 255, 153, 0.7); }
    .btn.wait { background: rgba(255, 182, 193, 0.6); }
    .btn.operation { background: rgba(238, 130, 238, 0.6); }

    #timeline {
      margin-top: 30px;
      padding: 20px;
      background: rgba(255, 255, 255, 0.5);
      border-radius: 16px;
      box-shadow: 0 6px 12px rgba(0, 0, 0, 0.1);
      min-height: 80px;
    }
    .timeline-step {
      display: inline-block;
      margin: 5px;
      padding: 10px 12px;
      background: white;
      border-radius: 12px;
      font-size: 14px;
      border: 1px solid #ccc;
    }
    #alert {
      color: red;
      font-weight: bold;
      margin-top: 10px;
    }
  </style>
</head>
<body>
  <h2>🧩 運輸流程視覺模組</h2>
  
  <div class="section">
    <div class="section-title">🚛 重車 / 提貨點</div>
    <div class="button-group">
      <button class="btn pickup" onclick="addStep('藍海')">藍海</button>
      <button class="btn pickup" onclick="addStep('KY2')">KY2</button>
      <button class="btn pickup" onclick="addStep('KY3')">KY3</button>
      <button class="btn pickup" onclick="addStep('NK')">NK</button>
      <button class="btn pickup" onclick="addStep('KK')">KK</button>
    </div>
  </div>

  <div class="section">
    <div class="section-title">📦 卸貨點</div>
    <div class="button-group" id="dropoffs"></div>
  </div>

  <div class="section">
    <div class="section-title">🕒 路程</div>
    <div class="button-group">
      <button class="btn route" onclick="addStep('15分鐘')">15分鐘</button>
      <button class="btn route" onclick="addStep('30分鐘')">30分鐘</button>
      <button class="btn route" onclick="addStep('60分鐘')">60分鐘</button>
      <button class="btn route" onclick="addStep('90分鐘')">90分鐘</button>
    </div>
  </div>

  <div class="section">
    <div class="section-title">⏳ 等待</div>
    <div class="button-group">
      <button class="btn wait" onclick="addStep('等待15分鐘')">等待15分鐘</button>
      <button class="btn wait" onclick="addStep('等待30分鐘')">等待30分鐘</button>
      <button class="btn wait" onclick="addStep('等待60分鐘')">等待60分鐘</button>
      <button class="btn wait" onclick="addStep('等待90分鐘')">等待90分鐘</button>
    </div>
  </div>

  <div class="section">
    <div class="section-title">🔧 作業時間</div>
    <div class="button-group">
      <button class="btn operation" onclick="addStep('作業00:30')">00:30</button>
      <button class="btn operation" onclick="addStep('作業00:45')">00:45</button>
      <button class="btn operation" onclick="addStep('作業01:45')">01:45</button>
    </div>
  </div>

  <div id="timeline">
    <strong>🚚 運輸流程時間線：</strong>
  </div>
  <div id="alert"></div>

  <script>
    const dropoffs = [
      '鹿港銀泰','矽品潭子大','友達后里備用','環鴻新桶','環鴻南崗','美光后里','展頌斗六','展送竹山','矽品潭子小','晉椿','松和50N','久允工業','明基材料','艾杰旭一期','菱生中港','菱生2廠','菱生5廠','菱生1廠','矽品和美一期','矽品和美二期','超豐頭份','烏日啤酒','中油台中80N','台灣特品','台大氣體','巨菱精密','亞洲光學','美光FBT','隆達竹南廠','旺宏新竹735A'
    ];
    dropoffs.forEach(name => {
      const btn = document.createElement('button');
      btn.className = 'btn dropoff';
      btn.innerText = name;
      btn.onclick = () => addStep(name);
      document.getElementById('dropoffs').appendChild(btn);
    });

    const timeline = document.getElementById("timeline");
    const alertBox = document.getElementById("alert");
    let steps = [];

    function addStep(step) {
      alertBox.innerText = '';
      const last = steps[steps.length - 1] || '';
      const isDropoff = dropoffs.includes(step);
      const isRoute = /分鐘$/.test(step) && !step.startsWith("等待");

      if (isDropoff && last && dropoffs.includes(last)) {
        alertBox.innerText = '❗ 卸貨點後不能再接卸貨點，請加入路程或作業';
        return;
      }

      // 自動補車場
      if (isDropoff && !isRoute) {
        const next = steps[steps.length];
        if (!next || (!dropoffs.includes(next) && !next.includes('分鐘'))) {
          steps.push('路程：60分鐘');
          steps.push('回車場');
        }
      }

      steps.push(step);
      renderTimeline();
    }

    function renderTimeline() {
      timeline.innerHTML = '<strong>🚚 運輸流程時間線：</strong>';
      steps.forEach(s => {
        const el = document.createElement('span');
        el.className = 'timeline-step';
        el.innerText = s;
        timeline.appendChild(el);
      });
    }
  </script>
</body>
</html>
