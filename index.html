<!DOCTYPE html>
<html lang="zh-Hant">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>運輸流程時間線工具</title>
  <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+TC:wght@500;900&display=swap" rel="stylesheet">
  <style>
    html, body { background: linear-gradient(135deg, #e9eef7 0%, #f6f9fe 100%); margin:0; padding:0; font-family: 'Noto Sans TC', 'San Francisco', 'PingFang TC', 'Helvetica Neue', Helvetica, Arial, sans-serif; }
    .container { max-width: 950px; margin: 28px auto 18px auto; background: rgba(255,255,255,0.55); border-radius: 22px; box-shadow: 0 8px 32px rgba(30,40,110,0.07), 0 1.5px 8px rgba(180,190,220,0.09); padding: 2.1em 1.5em 1.2em 1.5em; backdrop-filter: blur(16px) saturate(1.25);}
    h1 { text-align: center; margin-bottom: 1.1em; letter-spacing: 1.2px; font-size: 2em; font-weight: 600;}
    .label { font-weight: 600; margin: 1.2em 0 0.2em 0; font-size: 1.07em; color: #54585f;}
    .section { display: flex; flex-wrap: wrap; gap: 0.55em; margin-bottom: 0.3em;}
    .block-btn { padding: 8px 17px; font-size: 15.5px; border: none; border-radius: 13px; font-weight: 600; letter-spacing: 1px; margin-bottom: 6px; margin-right: 3px; cursor: pointer; box-shadow: 0 1px 7px rgba(0,0,0,0.06); transition: transform 0.14s, box-shadow 0.19s; backdrop-filter: blur(18px) saturate(1.12); opacity: 0.96;}
    .block-btn:active { transform: scale(0.95);}
    .green { background: rgba(200,255,200,0.7);}
    .blue { background: rgba(189,219,255,0.82);}
    .gray { background: rgba(239,239,239,0.87);}
    .pink { background: rgba(255,209,229,0.77);}
    .purple-l { background: rgba(205,188,255,0.85);}   /* 提貨時間：淺紫 */
    .purple-d { background: rgba(163,137,255,0.80);}   /* 卸貨時間：深紫 */
    .timeline-area-flex { display: flex; align-items: flex-start; justify-content: flex-start; background: rgba(248,252,255,0.63); border-radius: 16px; min-height: 92px; margin: 2em 0 1.5em 0; box-shadow: 0 1px 7px rgba(120,140,190,0.07); padding: 16px 12px 15px 13px; overflow-x: auto;}
    .timeline-area { display: flex; flex-wrap: wrap; gap: 13px 9px;}
    .timeline-block { display: inline-flex; flex-direction: column; align-items: center; position: relative; border-radius: 13px; min-width: 90px; max-width: 180px; padding: 7px 10px 8px 10px; font-size: 15.1px; font-weight: 500; letter-spacing: 0.8px; box-shadow: 0 2px 7px rgba(120,150,170,0.06); backdrop-filter: blur(19px) saturate(1.18); margin: 0 0 3px 0; margin-right: 0; transition: box-shadow 0.19s;}
    .timeline-block .del-btn { position: absolute; top: 3.5px; right: 3.5px; background: rgba(255,90,90,0.88); color: #fff; border: none; border-radius: 50%; width: 9px; height: 9px; font-size: 5.6px; line-height: 8px; cursor: pointer; font-weight: bold; padding: 0; display: flex; align-items: center; justify-content: center; box-shadow: 0 0.5px 2px rgba(180,0,0,0.08); transition: background 0.19s, transform 0.12s; z-index: 2;}
    .timeline-block .del-btn:hover { background: #bc2525; transform: scale(1.1);}
    .timeline-row-1 { font-weight: 900; font-size: 16px; }
    .timeline-row-2 { font-weight: 400; font-size: 13.5px; margin-top:1px; color: #696b70; min-height:17px;}
    .timeline-row-3 { font-weight: 900; font-size: 17px; color: #244D4E; letter-spacing: 0.1px; margin-top: 2.5px;}
    .custom-input { padding: 7px 12px; border-radius: 8px; border: 1px solid #bbc7d2; margin-right: 4px; font-size: 15px; outline: none; background: #f9fcff; box-shadow: 0 1px 4px rgba(110,160,200,0.03);}
    .summary-bar { font-size: 1.08em; font-weight: 600; letter-spacing: 0.8px; min-width: 255px; color: #535353; text-align: right; margin-top: 8px; display: flex; flex-direction: row; align-items: center; justify-content: flex-end; gap: 20px;}
    .summary-row { margin-bottom: 5px; margin-right: 14px;}
    .ios-timeline-flexwrap { display: flex; align-items: flex-start; justify-content: space-between;}
    .starttime-row { display: flex; align-items: center; gap: 8px; margin: 0 0 0 0;}
    .start-label { font-size: 16px; font-weight: 600; color: #333; margin-right: 2px;}
    @media (max-width:900px){
      .container {max-width: 99vw;}
      .timeline-area-flex {padding-right: 5px;}
      .ios-timeline-flexwrap { flex-direction: column; }
      .summary-bar { margin-left: 0; margin-top: 18px;}
      .starttime-row {justify-content: flex-start;}
    }
  </style>
</head>
<body>
  <div class="container">
    <h1>運輸流程時間線工具</h1>
    <div class="label">提貨點</div>
    <div class="section" id="pickupSection">
      <button class="block-btn green" onclick="addBlock('提貨點','車場','green')">車場</button>
      <button class="block-btn green" onclick="addBlock('提貨點','重車','green')">重車</button>
      <button class="block-btn green" onclick="addBlock('提貨點','BOIG','green')">BOIG</button>
      <button class="block-btn green" onclick="addBlock('提貨點','KY2','green')">KY2</button>
      <button class="block-btn green" onclick="addBlock('提貨點','KY3','green')">KY3</button>
      <button class="block-btn green" onclick="addBlock('提貨點','NK','green')">NK</button>
      <button class="block-btn green" onclick="addBlock('提貨點','KK','green')">KK</button>
      <input type="text" id="pickupInput" class="custom-input" placeholder="手動輸入"/>
      <button class="block-btn green" onclick="addCustomBlock('提貨點')">新增</button>
    </div>
    <div class="label">卸貨點</div>
    <div class="section" id="dropSection" style="max-width:100%;">
      <!-- 全部卸貨點 ...（省略）... -->
      <button class="block-btn blue" onclick="addBlock('卸貨點','展頌竹山','blue')">展頌竹山</button>
      <!-- 其他卸貨點按鈕同上 -->
      <input type="text" id="dropInput" class="custom-input" placeholder="手動輸入"/>
      <button class="block-btn blue" onclick="addCustomBlock('卸貨點')">新增</button>
    </div>
    <div class="label">路程時間</div>
    <div class="section">
      <button class="block-btn gray" onclick="addTimeBlock('路程', 15, 'gray')">15分鐘</button>
      <button class="block-btn gray" onclick="addTimeBlock('路程', 30, 'gray')">30分鐘</button>
      <button class="block-btn gray" onclick="addTimeBlock('路程', 60, 'gray')">60分鐘</button>
    </div>
    <div class="label">等待時間</div>
    <div class="section">
      <button class="block-btn pink" onclick="addTimeBlock('等待', 15, 'pink')">15分鐘</button>
      <button class="block-btn pink" onclick="addTimeBlock('等待', 30, 'pink')">30分鐘</button>
      <button class="block-btn pink" onclick="addTimeBlock('等待', 60, 'pink')">60分鐘</button>
    </div>
    <div class="label">提貨/卸貨時間</div>
    <div class="section">
      <button class="block-btn purple-l" onclick="addTimeBlock('提貨時間', 15, 'purple-l')">提貨 15分鐘</button>
      <button class="block-btn purple-l" onclick="addTimeBlock('提貨時間', 30, 'purple-l')">提貨 30分鐘</button>
      <button class="block-btn purple-l" onclick="addTimeBlock('提貨時間', 60, 'purple-l')">提貨 60分鐘</button>
      <button class="block-btn purple-d" onclick="addTimeBlock('卸貨時間', 15, 'purple-d')">卸貨 15分鐘</button>
      <button class="block-btn purple-d" onclick="addTimeBlock('卸貨時間', 30, 'purple-d')">卸貨 30分鐘</button>
      <button class="block-btn purple-d" onclick="addTimeBlock('卸貨時間', 60, 'purple-d')">卸貨 60分鐘</button>
    </div>
    <div class="label" style="margin-top:1.7em;"></div>

    <!-- 出發時間獨立一欄，整頁只建立一次 input，不重複渲染！ -->
    <div class="summary-bar" style="margin-top:10px; margin-bottom:10px; justify-content: flex-start;">
      <span class="starttime-row">
        <span class="start-label">出發時間：</span>
        <input type="time" id="startTime" value="06:00" class="custom-input" style="width:100px;"/>
      </span>
      <span class="summary-row" id="endTimeLabel"></span>
      <span class="summary-row" id="workTimeLabel"></span>
    </div>
    <div class="ios-timeline-flexwrap">
      <div class="timeline-area-flex">
        <div class="timeline-area" id="timeline"></div>
      </div>
    </div>
  </div>
  <script>
    let timelineData = [];
    let groupCounter = 0;
    function toHHMM(mins) {
      let h = Math.floor(mins/60)%24;
      let m = mins%60;
      return (h<10?'0':'')+h+':'+(m<10?'0':'')+m;
    }
    function updateTimeline() {
      const timeline = document.getElementById('timeline');
      timeline.innerHTML = '';
      let totalMin = 0;
      let startStr = document.getElementById('startTime').value || '06:00';
      let [h, m] = startStr.split(':').map(x=>parseInt(x,10));
      let nowMin = h*60 + m;
      let timeNow = nowMin;

      for(let i=0;i<timelineData.length;i++) {
        const block = timelineData[i];
        const node = document.createElement('div');
        node.className = 'timeline-block '+block.color;

        // 刪除按鈕（右上）
        let btn = document.createElement('button');
        btn.className = 'del-btn';
        btn.innerText = '✕';
        btn.onclick = ()=>delBlockAndAfter(i);
        node.appendChild(btn);

        // 第一行：標題或地點
        let row1 = document.createElement('div');
        row1.className = 'timeline-row-1';
        if(block.type==='提貨點'||block.type==='卸貨點') row1.innerText = block.label;
        else if(block.type==='路程') row1.innerHTML = '路程 ➜';
        else if(block.type==='等待') row1.innerText = '等待';
        else if(block.type==='提貨時間') row1.innerText = '提貨時間';
        else if(block.type==='卸貨時間') row1.innerText = '卸貨時間';

        // 第二行：該方塊所需時間
        let row2 = document.createElement('div');
        row2.className = 'timeline-row-2';
        if(['路程','等待','提貨時間','卸貨時間'].includes(block.type)){
          row2.innerText = toHHMM(block.minute);
        } else {
          row2.innerText = '';
        }

        // 第三行：累加後的新時間 (24小時制)
        let row3 = document.createElement('div');
        row3.className = 'timeline-row-3';
        if(['路程','等待','提貨時間','卸貨時間'].includes(block.type)){
          timeNow += block.minute;
          row3.innerText = toHHMM(timeNow);
        } else {
          row3.innerText = toHHMM(timeNow);
        }
        node.appendChild(row1);
        node.appendChild(row2);
        node.appendChild(row3);
        timeline.appendChild(node);

        if(['路程','等待','提貨時間','卸貨時間'].includes(block.type)) totalMin += block.minute;
      }
      // 總結
      let minStr = toHHMM(totalMin);
      let endMins = nowMin + totalMin;
      let eh = Math.floor(endMins/60)%24, em = endMins%60;
      let endStr = `${eh.toString().padStart(2,'0')}:${em.toString().padStart(2,'0')}`;
      document.getElementById('endTimeLabel').innerHTML = `預計結束時間：${endStr}`;
      document.getElementById('workTimeLabel').innerHTML = `總工時：${totalMin} 分鐘｜${minStr}`;
    }
    function delBlockAndAfter(idx) {
      timelineData = timelineData.slice(0, idx);
      updateTimeline();
    }
    function addBlock(type, label, color) {
      groupCounter++;
      timelineData.push({type, label, color, minute: 0, groupId: groupCounter});
      updateTimeline();
    }
    function addCustomBlock(type) {
      let inputId = (type === '提貨點') ? 'pickupInput' : 'dropInput';
      let color = (type === '提貨點') ? 'green' : 'blue';
      let txt = document.getElementById(inputId).value.trim();
      if (!txt) return;
      addBlock(type, txt, color);
      document.getElementById(inputId).value = '';
    }
    function addTimeBlock(type, min, color) {
      let last = timelineData.length ? timelineData[timelineData.length-1] : null;
      if(last && last.type === type && ['路程','等待','提貨時間','卸貨時間'].includes(type)) {
        last.minute += min;
      } else {
        groupCounter++;
        let label = type;
        timelineData.push({type, label, color, minute: min, groupId: groupCounter});
      }
      updateTimeline();
    }
    // 頁面載入時只綁一次
    window.onload = function(){
      document.getElementById('startTime').addEventListener('input', updateTimeline);
      updateTimeline();
    };
  </script>
</body>
</html>
